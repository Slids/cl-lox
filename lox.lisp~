(defpackage :lox
  (:include #:cl-user))

(:in-package :lox)

(defun main ()
  (let ((args (cdr sb-ext:*posix-argv*)))
    (cond ((> (length args) 1)
	   (print "Usage cl-lox: cl-lox [script]"))
	  ((= (length args) 1)
	   (runfile (car args)))
	  (t (run-prompt)))))

(defun run-file (path)
  (let (file)
    (with-open-file (stream path :direction :input)
      (setf file
	    (loop for line = (read-line stream nil)
		  while line
		  collect line)))
    (run file)))

(defun run-prompt ()
  (print "> ")
  (loop for line = (read-line)
	while line
	do
	   (run line)
	   (print "> ")))

(defun run (source)
  (declare (type source string))
  (print source))
	
  
	   
